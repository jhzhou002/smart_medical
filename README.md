## é¡¹ç›®åç§°

# åŒ»ç–—å¤šæ¨¡æ€æ™ºèƒ½åˆ†æå¹³å°
### Smart Medical Multimodal Analysis Platform

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Node.js](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)
![OpenTenBase](https://img.shields.io/badge/OpenTenBase-AI%20Plugin-orange.svg)
![PL/pgSQL](https://img.shields.io/badge/PL%2FpgSQL-800%2B%20lines-blue.svg)
![Vue3](https://img.shields.io/badge/Vue-3.x-42b883.svg)

> åŸºäº **OpenTenBase åˆ†å¸ƒå¼æ•°æ®åº“**åŠå…¶ **AI æ’ä»¶ï¼ˆopentenbase_aiï¼‰**çš„åŒ»ç–—å¤šæ¨¡æ€æ™ºèƒ½åˆ†æç³»ç»Ÿã€‚
>
> æœ¬ç³»ç»Ÿå°† AI èƒ½åŠ›å†…ç½®äºæ•°æ®åº“å±‚ï¼Œé€šè¿‡ **PL/pgSQL å­˜å‚¨è¿‡ç¨‹**å®ç°**ç—…å†æ–‡æœ¬ã€CT å½±åƒã€å®éªŒå®¤æŒ‡æ ‡ã€æ‚£è€…ä¿¡æ¯**å››ç§æ¨¡æ€æ•°æ®çš„**ç»“æ„åŒ–å…³è”åˆ†æ**ï¼Œç”Ÿæˆæ™ºèƒ½è¯Šæ–­æŠ¥å‘Šã€‚

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### â­ æ•°æ®åº“ç«¯æ™ºèƒ½åˆ†æï¼ˆæ–°å¢ï¼‰

**åŸºäº PL/pgSQL çš„å¤šæ¨¡æ€åˆ†æå¼•æ“** - æ»¡è¶³"å¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆæ‰“é€ "æ¯”èµ›è¦æ±‚

1. **â‰¥3 æ¨¡æ€æ•°æ®æ•´åˆ** âœ…
   - ç—…å†æ–‡æœ¬æ¨¡æ€ï¼ˆOCR + NLP æ€»ç»“ï¼‰
   - CT å½±åƒæ¨¡æ€ï¼ˆå›¾åƒåˆ†æ + ç—…ç¶è¯†åˆ«ï¼‰
   - å®éªŒå®¤æŒ‡æ ‡æ¨¡æ€ï¼ˆè¡¨æ ¼è¯†åˆ« + JSONB å­˜å‚¨ï¼‰
   - æ‚£è€…åŸºæœ¬ä¿¡æ¯æ¨¡æ€

2. **ç»Ÿä¸€ SQL å…³è”åˆ†æ** âœ…
   - ä½¿ç”¨ `LATERAL JOIN` å®ç°è·¨æ¨¡æ€æ•°æ®å…³è”
   - ä¸€æ¡ SQL æŸ¥è¯¢æ‰€æœ‰æ¨¡æ€æ•°æ®
   - åŸºäºåˆ†ç‰‡é”® `patient_id` ä¼˜åŒ–æ€§èƒ½

3. **PL/pgSQL å¤æ‚åˆ†ææµç¨‹** âœ…
   - 6 ä¸ªæ ¸å¿ƒå­˜å‚¨è¿‡ç¨‹ï¼ˆ800+ è¡Œä»£ç ï¼‰
   - 1 ä¸ªæ•°æ®åº“è§¦å‘å™¨ï¼ˆè‡ªåŠ¨åˆ†æï¼‰
   - 1 ä¸ªå¤šæ¨¡æ€ç»Ÿä¸€è§†å›¾
   - Z-score ç»Ÿè®¡å­¦å¼‚å¸¸æ£€æµ‹ç®—æ³•

4. **æ•°æ®åº“å±‚ AI è°ƒç”¨** âœ…
   - `ai.image()` - OCRã€å›¾åƒåˆ†æ
   - `ai.generate_text()` - è¯Šæ–­æ–‡æœ¬ç”Ÿæˆ
   - æ•°æ®ä¸åŠ¨ç®—æ³•åŠ¨ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“

5. **è¯æ®å¯è¿½æº¯æ€§** âœ…
   - æ¯æ¡è¯Šæ–­è¯æ®åŒ…å«ï¼šæ¨¡æ€ç±»å‹ã€æ•°æ®æ¥æºã€æƒé‡ã€åŸå§‹æ•°æ®ID
   - JSONB æ ¼å¼å­˜å‚¨è¯æ®é“¾
   - å‰ç«¯å¯è·³è½¬åˆ°åŸå§‹æ•°æ®

### ğŸš€ ä¸»è¦åŠŸèƒ½

- ğŸ¤– **æ•°æ®åº“ç«¯æ™ºèƒ½è¯Šæ–­** - PL/pgSQL èåˆå¤šæ¨¡æ€æ•°æ®ï¼Œç”Ÿæˆç»“æ„åŒ–è¯Šæ–­æŠ¥å‘Š
- ğŸ” **å…³é”®è¯æ®æå–** - è‡ªåŠ¨æå–è¯Šæ–­ä¾æ®ï¼Œå«æƒé‡å’Œæº¯æºä¿¡æ¯
- ğŸ“Š **å¼‚å¸¸æ£€æµ‹** - åŸºäº Z-score çš„ç»Ÿè®¡å­¦å¼‚å¸¸è¯†åˆ«
- ğŸ“ˆ **è¶‹åŠ¿åˆ†æ** - çª—å£å‡½æ•°å®ç°æŒ‡æ ‡æ—¶é—´åºåˆ—åˆ†æ
- ğŸ“„ **PDF æŠ¥å‘Šå¯¼å‡º** - å®Œæ•´åˆ†ææŠ¥å‘Šä¸€é”®å¯¼å‡º
- ğŸ¨ **ç°ä»£åŒ–å‰ç«¯ç•Œé¢** - Vue 3 + Element Plus + TailwindCSS

---

## ğŸ—ï¸ æ•°æ®åº“ç«¯ PL/pgSQL åˆ†æåŠŸèƒ½

### æ ¸å¿ƒå­˜å‚¨è¿‡ç¨‹

```sql
-- 1. å¤šæ¨¡æ€æ•°æ®ç»Ÿä¸€æŸ¥è¯¢ï¼ˆLATERAL JOINï¼‰
CREATE FUNCTION get_multimodal_data(p_patient_id INT)
RETURNS TABLE(patient_info JSONB, text_data JSONB, ct_data JSONB, lab_data JSONB)

-- 2. å…³é”®è¯æ®æå–ï¼ˆå«æƒé‡å’Œæº¯æºï¼‰
CREATE FUNCTION extract_key_evidence(p_patient_id INT)
RETURNS JSONB

-- 3. å®éªŒå®¤æŒ‡æ ‡å¼‚å¸¸æ£€æµ‹ï¼ˆZ-score ç®—æ³•ï¼‰
CREATE FUNCTION detect_lab_anomalies(p_patient_id INT)
RETURNS TABLE(indicator TEXT, current_value NUMERIC, z_score NUMERIC, severity TEXT)

-- 4. æ™ºèƒ½è¯Šæ–­ï¼ˆæ ¸å¿ƒåŠŸèƒ½ - è°ƒç”¨ AI æ’ä»¶ï¼‰
CREATE FUNCTION smart_diagnosis_v2(p_patient_id INT)
RETURNS JSONB

-- 5. CT è‡ªåŠ¨åˆ†æè§¦å‘å™¨
CREATE FUNCTION auto_analyze_ct_trigger()
RETURNS TRIGGER

-- 6. å¤šæ¨¡æ€ç»Ÿä¸€è§†å›¾
CREATE VIEW v_patient_multimodal AS ...
```

### æ•°æ®åº“ç«¯åˆ†ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1. ç”¨æˆ·ä¸Šä¼ å¤šæ¨¡æ€æ•°æ®                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç—…å†å›¾ç‰‡ â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_text_data                 â”‚
â”‚  CT å½±åƒ  â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_ct_data                   â”‚
â”‚  å®éªŒå®¤è¡¨æ ¼ â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_lab_data                â”‚
â”‚              â†“                                               â”‚
â”‚       æ‰€æœ‰æ•°æ®é€šè¿‡ patient_id å…³è”                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         2. AI æ’ä»¶æå–ç»“æ„åŒ–æ•°æ®ï¼ˆæ•°æ®åº“å†…æ‰§è¡Œï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ai.image(ç—…å†URL) â†’ OCRæ–‡æœ¬ â†’ è‡ªç„¶è¯­è¨€æ€»ç»“                  â”‚
â”‚  ai.image(CT URL) â†’ å½±åƒåˆ†æ â†’ ç—…ç¶è¯†åˆ«ç»“æœ                  â”‚
â”‚  ai.image(æŒ‡æ ‡URL) â†’ è¡¨æ ¼è¯†åˆ« â†’ JSONB ç»“æ„åŒ–æ•°æ®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      3. PL/pgSQL å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œå¤šæ¨¡æ€å…³è”åˆ†æ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  get_multimodal_data(patient_id)                            â”‚
â”‚    â”œâ”€ LATERAL JOIN ç—…å†ã€CTã€å®éªŒå®¤æ•°æ®                      â”‚
â”‚    â””â”€ è¿”å›ç»Ÿä¸€ JSONB ç»“æ„                                    â”‚
â”‚                        â†“                                     â”‚
â”‚  extract_key_evidence(patient_id)                           â”‚
â”‚    â”œâ”€ æå–ç—…å†å…³é”®å‘ç°ï¼ˆæƒé‡ 0.7ï¼‰                           â”‚
â”‚    â”œâ”€ æå– CT å½±åƒå‘ç°ï¼ˆæƒé‡ 0.9ï¼‰                           â”‚
â”‚    â”œâ”€ æå–å¼‚å¸¸æŒ‡æ ‡ï¼ˆæƒé‡ 0.8ï¼‰                               â”‚
â”‚    â””â”€ è¿”å› JSONB è¯æ®æ•°ç»„ï¼ˆå« data_id æº¯æºï¼‰                 â”‚
â”‚                        â†“                                     â”‚
â”‚  detect_lab_anomalies(patient_id)                           â”‚
â”‚    â”œâ”€ æŸ¥è¯¢æ‚£è€…å†å²æŒ‡æ ‡æ•°æ®                                   â”‚
â”‚    â”œâ”€ è®¡ç®—å‡å€¼ã€æ ‡å‡†å·®ï¼ˆç»Ÿè®¡å­¦ï¼‰                             â”‚
â”‚    â”œâ”€ Z-score = (å½“å‰å€¼ - å‡å€¼) / æ ‡å‡†å·®                     â”‚
â”‚    â””â”€ è¿”å›å¼‚å¸¸æŒ‡æ ‡åˆ—è¡¨                                       â”‚
â”‚                        â†“                                     â”‚
â”‚  smart_diagnosis_v2(patient_id)                             â”‚
â”‚    â”œâ”€ è°ƒç”¨ get_multimodal_data() è·å–å…¨éƒ¨æ•°æ®                â”‚
â”‚    â”œâ”€ è°ƒç”¨ extract_key_evidence() è·å–è¯æ®                   â”‚
â”‚    â”œâ”€ è°ƒç”¨ ai.generate_text() ç”Ÿæˆè¯Šæ–­ç»“è®º                   â”‚
â”‚    â”œâ”€ è®¡ç®—ç½®ä¿¡åº¦ã€é£é™©è¯„åˆ†                                   â”‚
â”‚    â”œâ”€ æå–æ²»ç–—å»ºè®®                                           â”‚
â”‚    â””â”€ å­˜å…¥ patient_diagnosis è¡¨ï¼ˆå« evidence_jsonï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               4. ç»“æ„åŒ–è¯Šæ–­ç»“æœè¿”å›                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                          â”‚
â”‚    "diagnosis_id": 15,                                     â”‚
â”‚    "patient_id": 9,                                        â”‚
â”‚    "diagnosis": "æ€¥æ€§ç—…æ¯’æ€§è„‘ç‚",                           â”‚
â”‚    "confidence": 0.85,                                     â”‚
â”‚    "risk_score": 0.65,                                     â”‚
â”‚    "evidence": [                                           â”‚
â”‚      {                                                     â”‚
â”‚        "modality": "text",                                â”‚
â”‚        "source": "medical_record",                        â”‚
â”‚        "finding": "çªå‘é«˜çƒ­ã€å‰§çƒˆå¤´ç—›...",                 â”‚
â”‚        "weight": 0.7,                                     â”‚
â”‚        "data_id": 22                                      â”‚
â”‚      }                                                     â”‚
â”‚    ],                                                      â”‚
â”‚    "recommendations": [                                    â”‚
â”‚      "ç«‹å³å®Œå–„å¤´é¢…MRIæ£€æŸ¥...",                             â”‚
â”‚      "ç»§ç»­é˜¿æ˜”æ´›éŸ¦é™è„‰è¾“æ³¨..."                             â”‚
â”‚    ],                                                      â”‚
â”‚    "source": "database_plpgsql"                           â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API æ¥å£ï¼ˆè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼‰

```bash
# 1. å¤šæ¨¡æ€æ•°æ®æŸ¥è¯¢
GET /api/db-analysis/multimodal/:patient_id

# 2. å…³é”®è¯æ®æå–
GET /api/db-analysis/evidence/:patient_id

# 3. å¼‚å¸¸æ£€æµ‹
GET /api/db-analysis/anomalies/:patient_id

# 4. æ™ºèƒ½è¯Šæ–­ï¼ˆæ ¸å¿ƒï¼‰
POST /api/db-analysis/smart-diagnosis
Body: { "patient_id": 9 }

# 5. å¤šæ¨¡æ€è§†å›¾æŸ¥è¯¢
GET /api/db-analysis/view/multimodal?patient_id=9

# 6. ç»¼åˆåˆ†æï¼ˆå¹¶è¡Œè°ƒç”¨æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹ï¼‰
GET /api/db-analysis/comprehensive/:patient_id
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js** >= 18.0.0
- **OpenTenBase æ•°æ®åº“**ï¼ˆå·²å®‰è£… `opentenbase_ai` æ’ä»¶ï¼‰
- **ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨è´¦å·**ï¼ˆç”¨äºæ–‡ä»¶å­˜å‚¨ï¼‰
- **SSH éš§é“**ï¼ˆè¿æ¥è¿œç¨‹ OpenTenBaseï¼‰

### ä¸€é”®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/jhzhou002/smart_medical.git
cd smart_medical

# 2. å»ºç«‹ SSH éš§é“ï¼ˆè¿æ¥è¿œç¨‹ OpenTenBaseï¼‰
ssh -L 5432:10.3.0.7:11000 opentenbase@123.207.69.169
# ä¿æŒæ­¤ç»ˆç«¯çª—å£å¼€å¯

# 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆæ–°ç»ˆç«¯ï¼‰
# åˆ›å»ºæ•°æ®åº“
psql -h 127.0.0.1 -p 5432 -U opentenbase -d postgres -f database/init.sql

# åˆ›å»ºè¡¨ç»“æ„
psql -h 127.0.0.1 -p 5432 -U opentenbase -d smart_medical -f database/schema.sql

# éƒ¨ç½² PL/pgSQL å­˜å‚¨è¿‡ç¨‹ï¼ˆæ–°å¢ï¼‰
psql -h 127.0.0.1 -p 5432 -U opentenbase -d smart_medical -f database/procedures/create_and_alter_diagnosis.sql
psql -h 127.0.0.1 -p 5432 -U opentenbase -d smart_medical -f database/procedures/multimodal_analysis.sql

# 4. å¯åŠ¨åç«¯æœåŠ¡
cd backend
npm install
cp .env.example .env  # ç¼–è¾‘ .env é…ç½®æ•°æ®åº“å’Œä¸ƒç‰›äº‘
npm run dev           # åç«¯å¯åŠ¨åœ¨ http://127.0.0.1:3000

# 5. å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm install
npm run dev           # å‰ç«¯å¯åŠ¨åœ¨ http://127.0.0.1:5173
```

### æµ‹è¯•æ•°æ®åº“ç«¯åŠŸèƒ½

```bash
# æµ‹è¯• PL/pgSQL å‡½æ•°
cd backend
node test-database-functions.js

# æµ‹è¯• API æ¥å£
curl http://127.0.0.1:3000/api/db-analysis/multimodal/9
curl http://127.0.0.1:3000/api/db-analysis/evidence/9
curl -X POST http://127.0.0.1:3000/api/db-analysis/smart-diagnosis \
  -H "Content-Type: application/json" \
  -d '{"patient_id": 9}'
```

**è®¿é—®åœ°å€**ï¼š
- åç«¯ API: `http://127.0.0.1:3000/api`
- å‰ç«¯ç•Œé¢: `http://127.0.0.1:5173`
- API æ–‡æ¡£: `http://127.0.0.1:3000/api`

---

## ğŸ“Š æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯å±‚ (Vue 3 + Element Plus)                â”‚
â”‚  æ‚£è€…ç®¡ç† | æ•°æ®ä¸Šä¼  | åˆ†æç»“æœ | PDF å¯¼å‡º             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åç«¯å±‚ (Node.js + Express)                   â”‚
â”‚  API è·¯ç”± | ä¸šåŠ¡æœåŠ¡ | æ–‡ä»¶ä¸Šä¼  | ä¸ƒç‰›äº‘é›†æˆ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ•°æ®åº“å±‚ (OpenTenBase + AI æ’ä»¶)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ PL/pgSQL å­˜å‚¨è¿‡ç¨‹ (800+ è¡Œ)                 â”‚     â”‚
â”‚  â”‚ - get_multimodal_data() - å¤šæ¨¡æ€æŸ¥è¯¢        â”‚     â”‚
â”‚  â”‚ - extract_key_evidence() - è¯æ®æå–         â”‚     â”‚
â”‚  â”‚ - detect_lab_anomalies() - å¼‚å¸¸æ£€æµ‹         â”‚     â”‚
â”‚  â”‚ - smart_diagnosis_v2() - æ™ºèƒ½è¯Šæ–­ï¼ˆæ ¸å¿ƒï¼‰   â”‚     â”‚
â”‚  â”‚ - auto_analyze_ct_trigger() - è‡ªåŠ¨è§¦å‘å™¨    â”‚     â”‚
â”‚  â”‚ - v_patient_multimodal - å¤šæ¨¡æ€è§†å›¾         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ AI æ’ä»¶ (opentenbase_ai)                    â”‚     â”‚
â”‚  â”‚ - ai.image() - OCR/å›¾åƒåˆ†æ                 â”‚     â”‚
â”‚  â”‚ - ai.generate_text() - æ–‡æœ¬ç”Ÿæˆ             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ åˆ†ç‰‡è¡¨ (DISTRIBUTE BY SHARD)                â”‚     â”‚
â”‚  â”‚ - patients - æ‚£è€…ä¿¡æ¯                       â”‚     â”‚
â”‚  â”‚ - patient_text_data - ç—…å†æ–‡æœ¬              â”‚     â”‚
â”‚  â”‚ - patient_ct_data - CT å½±åƒ                 â”‚     â”‚
â”‚  â”‚ - patient_lab_data - å®éªŒå®¤æŒ‡æ ‡ (JSONB)     â”‚     â”‚
â”‚  â”‚ - patient_diagnosis - è¯Šæ–­è®°å½• (å«è¯æ®)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              äº‘å­˜å‚¨å±‚ (ä¸ƒç‰›äº‘ CDN)                    â”‚
â”‚  ç—…å†å›¾ç‰‡ | CT å½±åƒ | å®éªŒå®¤æŒ‡æ ‡è¡¨æ ¼                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

**å‰ç«¯**ï¼š
- Vue 3 (Composition API) - æ¸è¿›å¼æ¡†æ¶
- Pinia - çŠ¶æ€ç®¡ç†
- Element Plus - UI ç»„ä»¶åº“
- TailwindCSS - åŸå­åŒ– CSS
- Axios - HTTP å®¢æˆ·ç«¯

**åç«¯**ï¼š
- Node.js + Express.js
- PL/pgSQL å­˜å‚¨è¿‡ç¨‹ï¼ˆ800+ è¡Œï¼‰
- OpenTenBase AI æ’ä»¶é›†æˆ
- ä¸ƒç‰›äº‘ SDKï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰
- Winstonï¼ˆæ—¥å¿—ç³»ç»Ÿï¼‰

**æ•°æ®åº“**ï¼š
- OpenTenBase åˆ†å¸ƒå¼æ•°æ®åº“
- opentenbase_ai æ’ä»¶ï¼ˆAI èƒ½åŠ›ï¼‰
- åˆ†ç‰‡è¡¨è®¾è®¡ï¼ˆpatient_id åˆ†ç‰‡é”®ï¼‰
- JSONB æ•°æ®ç±»å‹ï¼ˆå®éªŒå®¤æŒ‡æ ‡ã€è¯æ®é“¾ï¼‰

**ç®—æ³•**ï¼š
- Z-score å¼‚å¸¸æ£€æµ‹ï¼ˆç»Ÿè®¡å­¦ï¼‰
- LATERAL JOIN å¤šæ¨¡æ€å…³è”
- çª—å£å‡½æ•°è¶‹åŠ¿åˆ†æ
- AI ç”Ÿæˆå¼è¯Šæ–­

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
smart_medical/
â”œâ”€â”€ frontend/                       # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ PatientManagement.vue  # æ‚£è€…ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ DataUpload.vue         # æ•°æ®ä¸Šä¼ 
â”‚   â”‚   â”‚   â””â”€â”€ AnalysisResult.vue     # åˆ†æç»“æœï¼ˆé›†æˆæ–°ç»„ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ EvidenceViewer.vue     # å…³é”®è¯æ®å±•ç¤ºï¼ˆæ–°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ SmartDiagnosisPanel.vue # æ™ºèƒ½è¯Šæ–­é¢æ¿ï¼ˆæ–°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ RiskScoreGauge.vue     # é£é™©è¯„åˆ†ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â”œâ”€â”€ AnomalyDetection.vue   # å¼‚å¸¸æ£€æµ‹ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ TrendChart.vue         # è¶‹åŠ¿å›¾è¡¨
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ database-analysis.js   # æ•°æ®åº“åˆ†æ APIï¼ˆæ–°ï¼‰
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ api.js                 # Axios å°è£…
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                        # Node.js åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ db.js              # OpenTenBase è¿æ¥æ± 
â”‚   â”‚   â”‚   â””â”€â”€ logger.js          # Winston æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ patients.js        # æ‚£è€…ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ text-analysis.js   # ç—…å†åˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ ct-analysis.js     # CT åˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ lab-analysis.js    # å®éªŒå®¤æŒ‡æ ‡
â”‚   â”‚   â”‚   â”œâ”€â”€ diagnosis.js       # ç»¼åˆè¯Šæ–­
â”‚   â”‚   â”‚   â””â”€â”€ database-analysis.js # æ•°æ®åº“ç«¯åˆ†æï¼ˆæ–°ï¼‰
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ opentenbase-ai.js  # AI æ’ä»¶å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ qiniu.js           # ä¸ƒç‰›äº‘ä¸Šä¼ 
â”‚   â”‚   â””â”€â”€ app.js                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ test-database-functions.js # PL/pgSQL æµ‹è¯•è„šæœ¬ï¼ˆæ–°ï¼‰
â”‚   â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ database/                      # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ init.sql                  # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ schema.sql                # è¡¨ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ procedures/               # PL/pgSQL å­˜å‚¨è¿‡ç¨‹ï¼ˆæ–°ï¼‰
â”‚   â”‚   â”œâ”€â”€ create_and_alter_diagnosis.sql  # è¯Šæ–­è¡¨åˆ›å»º
â”‚   â”‚   â””â”€â”€ multimodal_analysis.sql         # å¤šæ¨¡æ€åˆ†æå‡½æ•°
â”‚   â””â”€â”€ seed.sql                  # æµ‹è¯•æ•°æ®
â”‚
â”œâ”€â”€ doc/                          # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°æ•´ä½“æ–¹æ¡ˆæ–‡æ¡£.md
â”‚   â”œâ”€â”€ 23-opentenbase_ai.md      # AI æ’ä»¶æ–‡æ¡£
â”‚   â””â”€â”€ æ‰©å±•æ–¹æ¡ˆ.md               # æ‰©å±•æ–¹æ¡ˆ
â”‚
â”œâ”€â”€ CLAUDE.md                     # Claude Code å·¥ä½œæŒ‡å—
â”œâ”€â”€ QUICKSTART.md                 # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

---

## ğŸ”¬ æµ‹è¯•ä¸éªŒè¯

### PL/pgSQL å‡½æ•°æµ‹è¯•

```bash
cd backend
node test-database-functions.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… get_multimodal_data() - å¤šæ¨¡æ€æŸ¥è¯¢
âœ… extract_key_evidence() - è¯æ®æå–
âœ… detect_lab_anomalies() - å¼‚å¸¸æ£€æµ‹
âœ… smart_diagnosis_v2() - æ™ºèƒ½è¯Šæ–­
âœ… v_patient_multimodal - è§†å›¾æŸ¥è¯¢
```

### API æ¥å£æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:3000/health

# æŸ¥çœ‹æ‰€æœ‰ API
curl http://127.0.0.1:3000/api

# å¤šæ¨¡æ€æŸ¥è¯¢
curl http://127.0.0.1:3000/api/db-analysis/multimodal/9

# æ™ºèƒ½è¯Šæ–­
curl -X POST http://127.0.0.1:3000/api/db-analysis/smart-diagnosis \
  -H "Content-Type: application/json" \
  -d '{"patient_id": 9}'
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | åº”ç”¨å±‚åˆ†æ | æ•°æ®åº“ç«¯åˆ†æï¼ˆæ–°ï¼‰ |
|---------|-----------|------------------|
| å®ç°æ–¹å¼ | Node.js ä»£ç  | PL/pgSQL å­˜å‚¨è¿‡ç¨‹ |
| æ•°æ®ä¼ è¾“ | å¤šæ¬¡ SQL æŸ¥è¯¢ | ä¸€æ¬¡æŸ¥è¯¢ï¼ˆLATERAL JOINï¼‰ |
| AI è°ƒç”¨ | åº”ç”¨å±‚å°è£… | æ•°æ®åº“å†…è°ƒç”¨ |
| æ€§èƒ½ | ä¸€èˆ¬ | ä¼˜ç§€ï¼ˆå‡å°‘ç½‘ç»œå¼€é”€ï¼‰ |
| è¯æ®æº¯æº | æ—  | æœ‰ï¼ˆJSONB evidence_jsonï¼‰ |
| å¼‚å¸¸æ£€æµ‹ | å‰ç«¯è®¡ç®— | Z-score ç®—æ³•ï¼ˆæ•°æ®åº“å†…ï¼‰ |
| é€‚ç”¨åœºæ™¯ | çµæ´»å¼€å‘ | é«˜æ€§èƒ½ã€ç»“æ„åŒ–åˆ†æ |

---

## ğŸ“– æ ¸å¿ƒæ–‡æ¡£

- **æ•´ä½“æ–¹æ¡ˆ**ï¼š[doc/åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°æ•´ä½“æ–¹æ¡ˆæ–‡æ¡£.md](doc/åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°æ•´ä½“æ–¹æ¡ˆæ–‡æ¡£ï¼ˆåŸºäºOpenTenBase%20AIæ’ä»¶ï¼‰.md)
- **AI æ’ä»¶æ–‡æ¡£**ï¼š[doc/23-opentenbase_ai.md](doc/23-opentenbase_ai.md)
- **å¼€å‘æŒ‡å—**ï¼š[CLAUDE.md](CLAUDE.md)
- **å¿«é€Ÿå¯åŠ¨**ï¼š[QUICKSTART.md](QUICKSTART.md)

---

## ğŸ¯ æ¯”èµ›è¦æ±‚æ»¡è¶³æƒ…å†µ

| è¦æ±‚ | å®ç°æƒ…å†µ | è¯´æ˜ |
|------|---------|------|
| **â‰¥3 æ¨¡æ€æ•´åˆ** | âœ… 4ä¸ªæ¨¡æ€ | ç—…å†æ–‡æœ¬ + CTå½±åƒ + å®éªŒå®¤æŒ‡æ ‡ + æ‚£è€…ä¿¡æ¯ |
| **ç»Ÿä¸€ SQL å…³è”** | âœ… LATERAL JOIN | `get_multimodal_data()` ä¸€æ¡ SQL æŸ¥è¯¢å…¨éƒ¨æ•°æ® |
| **PL/pgSQL å¤æ‚æµç¨‹** | âœ… 800+ è¡Œ | 6ä¸ªå­˜å‚¨è¿‡ç¨‹ + 1ä¸ªè§¦å‘å™¨ + 1ä¸ªè§†å›¾ |
| **æ•°æ®åº“ç«¯ AI** | âœ… å®Œæˆ | `ai.image()` + `ai.generate_text()` ç›´æ¥è°ƒç”¨ |
| **è¯æ®å¯è¿½æº¯æ€§** | âœ… JSONB | `evidence_json` å« `data_id`ã€`modality`ã€`weight` |

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

- âœ… å‚æ•°åŒ– SQL æŸ¥è¯¢ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰
- âœ… æ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯ï¼ˆæœ€å¤§ 50MBï¼‰
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ˆ.envï¼‰
- âœ… CORS è·¨åŸŸé…ç½®
- âœ… Winston æ—¥å¿—è®°å½•æ‰€æœ‰æ“ä½œ

---

## ğŸ‘¥ è´¡çŒ®è€…

### å¼€å‘å›¢é˜Ÿ

- **å‘¨ä½³è±ª** - å…¨æ ˆå¼€å‘è€… | é¡¹ç›®è´Ÿè´£äºº
  - é‚®ç®±: 318352733@qq.com
  - GitHub: [@jhzhou002](https://github.com/jhzhou002)
  - æŠ€æœ¯æ ˆ: Vue 3 + Node.js + OpenTenBase

### è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œç»„ç»‡:
- [OpenTenBase](https://github.com/OpenTenBase/OpenTenBase) - åˆ†å¸ƒå¼æ•°æ®åº“
- [å¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼š](https://www.openatom.org/) - æ¯”èµ›å¹³å°æ”¯æŒ
- [Vue.js](https://vuejs.org/) - å‰ç«¯æ¡†æ¶
- [Element Plus](https://element-plus.org/) - UI ç»„ä»¶åº“
- [ä¸ƒç‰›äº‘](https://www.qiniu.com/) - å¯¹è±¡å­˜å‚¨æœåŠ¡

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- é‚®ä»¶: 318352733@qq.com
- GitHub Issues: [æäº¤é—®é¢˜](https://github.com/jhzhou002/smart_medical/issues)

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼**

**ğŸ‰ æ„Ÿè°¢ä½¿ç”¨åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°ï¼**
