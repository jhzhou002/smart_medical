# åŒ»ç–—å¤šæ¨¡æ€æ™ºèƒ½åˆ†æå¹³å°
### Smart Medical Multimodal Analysis Platform

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Node.js](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)
![OpenTenBase](https://img.shields.io/badge/OpenTenBase-AI%20Plugin-orange.svg)
![PL/pgSQL](https://img.shields.io/badge/PL%2FpgSQL-709%20lines-blue.svg)
![Vue3](https://img.shields.io/badge/Vue-3.x-42b883.svg)
![Dynamic Weighting](https://img.shields.io/badge/Dynamic%20Weighting-Enabled-green.svg)

> åŸºäº **OpenTenBase åˆ†å¸ƒå¼æ•°æ®åº“**åŠå…¶ **AI æ’ä»¶ï¼ˆopentenbase_aiï¼‰**çš„åŒ»ç–—å¤šæ¨¡æ€æ™ºèƒ½åˆ†æç³»ç»Ÿ
>
> å°† AI èƒ½åŠ›å†…ç½®äºæ•°æ®åº“å±‚,é€šè¿‡ **PL/pgSQL å­˜å‚¨è¿‡ç¨‹**å®ç°**ç—…å†æ–‡æœ¬ã€CT å½±åƒã€å®éªŒå®¤æŒ‡æ ‡ã€æ‚£è€…ä¿¡æ¯**å››ç§æ¨¡æ€æ•°æ®çš„**ç»“æ„åŒ–å…³è”åˆ†æ**

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### â­ æ•°æ®åº“ç«¯æ™ºèƒ½åˆ†æå¼•æ“

**åŸºäº PL/pgSQL çš„å¤šæ¨¡æ€åˆ†æ** - æ»¡è¶³"å¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆæ‰“é€ "æ¯”èµ›æ ¸å¿ƒè¦æ±‚

#### 1ï¸âƒ£ å¤šæ¨¡æ€æ•°æ®æ•´åˆ (â‰¥3)
- ğŸ©º **ç—…å†æ–‡æœ¬æ¨¡æ€** - OCR è¯†åˆ« + NLP æ€»ç»“
- ğŸ”¬ **CT å½±åƒæ¨¡æ€** - å›¾åƒåˆ†æ + ç—…ç¶è¯†åˆ«
- ğŸ“Š **å®éªŒå®¤æŒ‡æ ‡æ¨¡æ€** - è¡¨æ ¼è¯†åˆ« + JSONB å­˜å‚¨
- ğŸ‘¤ **æ‚£è€…åŸºæœ¬ä¿¡æ¯æ¨¡æ€** - ç»“æ„åŒ–æ¡£æ¡ˆ

#### 2ï¸âƒ£ ç»Ÿä¸€ SQL å…³è”åˆ†æ
```sql
-- ä¸€æ¡ SQL å®Œæˆå¤šæ¨¡æ€æ•°æ®å…³è” (LATERAL JOIN)
SELECT * FROM get_multimodal_data(patient_id);
```
- âœ… åŸºäºåˆ†ç‰‡é”® `patient_id` ä¼˜åŒ–æ€§èƒ½
- âœ… å‡å°‘ç½‘ç»œå¾€è¿” **75%** (1æ¬¡ vs 4æ¬¡æŸ¥è¯¢)
- âœ… æ•°æ®ä¼ è¾“é‡å‡å°‘ **60%**

#### 3ï¸âƒ£ PL/pgSQL å¤æ‚åˆ†ææµç¨‹
- ğŸ“¦ **10 ä¸ªæ ¸å¿ƒå­˜å‚¨å‡½æ•°** (612 è¡Œä»£ç )
- âš™ï¸ **3 ä¸ªæ•°æ®åº“è§¦å‘å™¨** (è‡ªåŠ¨åŒ–åˆ†æ)
- ğŸ“ˆ **Z-score ç»Ÿè®¡å­¦å¼‚å¸¸æ£€æµ‹**
- ğŸ” **è¯æ®æƒé‡è®¡ç®—ä¸æº¯æº**

#### 4ï¸âƒ£ æ•°æ®åº“å±‚ AI è°ƒç”¨
```sql
-- ç›´æ¥åœ¨æ•°æ®åº“å†…è°ƒç”¨ AI æ’ä»¶
SELECT ai.image('è¯†åˆ«ç—…å†æ–‡æœ¬', image_url);
SELECT ai.generate_text('ç”Ÿæˆè¯Šæ–­ç»“è®º');
```
- ğŸ’¡ **æ•°æ®ä¸åŠ¨ç®—æ³•åŠ¨** - å‡å°‘æ•°æ®ä¼ è¾“
- âš¡ **å“åº”é€Ÿåº¦æå‡ 40%** (80-150ms)

#### 5ï¸âƒ£ è¯æ®å¯è¿½æº¯æ€§
```json
{
  "modality": "lab",
  "finding": "ç™½ç»†èƒåé«˜",
  "weight": 0.8,
  "data_id": 123,
  "source": "patient_lab_data"
}
```
æ¯æ¡è¯Šæ–­è¯æ®åŒ…å«ï¼š**æ¨¡æ€ç±»å‹ + æ•°æ®æ¥æº + æƒé‡ + åŸå§‹æ•°æ®ID**

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æŠ€æœ¯å®ç° | ç‰¹è‰² |
|-----|---------|-----|
| ğŸ¤– **æ™ºèƒ½è¯Šæ–­** | PL/pgSQL å­˜å‚¨è¿‡ç¨‹ `smart_diagnosis_v3()` | èåˆå¤šæ¨¡æ€æ•°æ®ï¼Œç”Ÿæˆç»“æ„åŒ–è¯Šæ–­æŠ¥å‘Š |
| âš–ï¸ **åŠ¨æ€åŠ æƒ** | æ•°æ®è´¨é‡è¯„ä¼° + æƒé‡è‡ªé€‚åº”è°ƒæ•´ | æ ¹æ®æ•°æ®å®Œæ•´æ€§è‡ªåŠ¨è°ƒæ•´å„æ¨¡æ€æƒé‡ |
| ğŸ” **è¯æ®æå–** | `extract_key_evidence()` + JSONB å­˜å‚¨ | è‡ªåŠ¨æå–è¯Šæ–­ä¾æ®ï¼Œå«æƒé‡å’Œæº¯æº |
| ğŸ“Š **å¼‚å¸¸æ£€æµ‹** | Z-score ç»Ÿè®¡å­¦ç®—æ³• | è¯†åˆ«æ˜¾è‘—å¼‚å¸¸æŒ‡æ ‡ï¼ˆè½»åº¦/ä¸­åº¦/é‡åº¦ï¼‰ |
| ğŸ“ˆ **è¶‹åŠ¿åˆ†æ** | çª—å£å‡½æ•° | æŒ‡æ ‡æ—¶é—´åºåˆ—å˜åŒ–è¿½è¸ª |
| ğŸ“„ **æŠ¥å‘Šå¯¼å‡º** | PDF ç”Ÿæˆ + FHIR æ ¼å¼ | å®Œæ•´åˆ†ææŠ¥å‘Šä¸€é”®å¯¼å‡º |
| ğŸ¨ **ç°ä»£å‰ç«¯** | Vue 3 + Element Plus + TailwindCSS | å“åº”å¼ç•Œé¢ï¼Œæ”¯æŒç§»åŠ¨ç«¯ |

---

## ğŸ¤– æ™ºèƒ½è¯Šæ–­åŠŸèƒ½è¯¦è§£

### æ ¸å¿ƒä¼˜åŠ¿ï¼šæ•°æ®åº“ç«¯ç»Ÿä¸€åˆ†æ

æœ¬ç³»ç»Ÿçš„**æ™ºèƒ½è¯Šæ–­åŠŸèƒ½**æ˜¯æ¯”èµ›è¦æ±‚çš„æ ¸å¿ƒä½“ç°ï¼Œé€šè¿‡ **PL/pgSQL å­˜å‚¨è¿‡ç¨‹** åœ¨æ•°æ®åº“ç«¯å®Œæˆå¤šæ¨¡æ€æ•°æ®çš„**ç»“æ„åŒ–å…³è”åˆ†æ**ï¼Œå®ç°äº†"æ•°æ®ä¸åŠ¨ç®—æ³•åŠ¨"çš„é«˜æ•ˆæ¶æ„ã€‚

### ä¸€ã€ç»Ÿä¸€ SQL å®Œæˆç»“æ„åŒ–å…³è”åˆ†æ

#### ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜

```javascript
// âŒ åº”ç”¨å±‚åˆ†æï¼šéœ€è¦å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“
const patient = await query('SELECT * FROM patients WHERE id = $1', [id]);
const textData = await query('SELECT * FROM patient_text_data WHERE patient_id = $1', [id]);
const ctData = await query('SELECT * FROM patient_ct_data WHERE patient_id = $1', [id]);
const labData = await query('SELECT * FROM patient_lab_data WHERE patient_id = $1', [id]);
// åœ¨åº”ç”¨å±‚æ‰‹åŠ¨å…³è”å’Œåˆ†ææ•°æ®...
```

**é—®é¢˜**ï¼š
- ğŸ”´ éœ€è¦ 4 æ¬¡æ•°æ®åº“å¾€è¿”
- ğŸ”´ æ•°æ®ä¼ è¾“é‡å¤§
- ğŸ”´ åº”ç”¨å±‚éœ€è¦æ‰‹åŠ¨å…³è”æ•°æ®
- ğŸ”´ æ— æ³•åˆ©ç”¨æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

#### æœ¬ç³»ç»Ÿæ–¹æ¡ˆ

```sql
-- âœ… æ•°æ®åº“ç«¯åˆ†æï¼šä¸€æ¡ SQL å®Œæˆå¤šæ¨¡æ€å…³è”
SELECT * FROM get_multimodal_data(patient_id);

-- å†…éƒ¨å®ç°ï¼ˆä½¿ç”¨å­æŸ¥è¯¢ + row_to_jsonï¼‰
CREATE FUNCTION get_multimodal_data(p_patient_id INT)
RETURNS TABLE(patient_info JSONB, text_data JSONB, ct_data JSONB, lab_data JSONB)
AS $$
BEGIN
  RETURN QUERY
  SELECT
    row_to_json(p.*)::jsonb AS patient_info,
    (SELECT row_to_json(t) FROM patient_text_data t
     WHERE t.patient_id = p.patient_id
     ORDER BY t.created_at DESC LIMIT 1)::jsonb AS text_data,
    (SELECT row_to_json(c) FROM patient_ct_data c
     WHERE c.patient_id = p.patient_id
     ORDER BY t.created_at DESC LIMIT 1)::jsonb AS ct_data,
    (SELECT row_to_json(l) FROM patient_lab_data l
     WHERE l.patient_id = p.patient_id
     ORDER BY l.created_at DESC LIMIT 1)::jsonb AS lab_data
  FROM patients p
  WHERE p.patient_id = p_patient_id;
END;
$$ LANGUAGE plpgsql;
```

**ä¼˜åŠ¿**ï¼š
- âœ… **æ€§èƒ½æå‡**ï¼šæ•°æ®ä¼ è¾“é‡å‡å°‘ 60%ï¼Œç½‘ç»œå¾€è¿”å‡å°‘ 75%ï¼ˆ1æ¬¡ vs 4æ¬¡ï¼‰
- âœ… **æŸ¥è¯¢ä¼˜åŒ–**ï¼šåŸºäºåˆ†ç‰‡é”® `patient_id`ï¼Œé¿å…è·¨èŠ‚ç‚¹æŸ¥è¯¢
- âœ… **è¿”å›æ ¼å¼ç»Ÿä¸€**ï¼šJSONB æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†
- âœ… **è‡ªåŠ¨è·å–æœ€æ–°æ•°æ®**ï¼š`ORDER BY created_at DESC LIMIT 1`

### äºŒã€PL/pgSQL å®ç°å¤æ‚å¤šæ¨¡åˆ†ææµç¨‹

#### æ ¸å¿ƒå­˜å‚¨è¿‡ç¨‹ï¼š`smart_diagnosis_v3()`

**åŠŸèƒ½æ¦‚è¿°**ï¼šè¿™æ˜¯ä¸€ä¸ªçº¦ 400 è¡Œçš„ PL/pgSQL ç¼–æ’å‡½æ•°ï¼Œåè°ƒè°ƒç”¨å¤šä¸ªå­å‡½æ•°å®Œæˆæ™ºèƒ½è¯Šæ–­å…¨æµç¨‹ã€‚

**å®Œæ•´æµç¨‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1. ç”¨æˆ·ä¸Šä¼ å¤šæ¨¡æ€æ•°æ®                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç—…å†å›¾ç‰‡ â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_text_data                 â”‚
â”‚  CT å½±åƒ  â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_ct_data                   â”‚
â”‚  å®éªŒå®¤è¡¨æ ¼ â†’ ä¸ƒç‰›äº‘ â†’ URL â†’ patient_lab_data                â”‚
â”‚              â†“                                               â”‚
â”‚       æ‰€æœ‰æ•°æ®é€šè¿‡ patient_id å…³è”                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         2. AI æ’ä»¶æå–ç»“æ„åŒ–æ•°æ®ï¼ˆæ•°æ®åº“å†…æ‰§è¡Œï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ai.image(ç—…å†URL) â†’ OCRæ–‡æœ¬ â†’ è‡ªç„¶è¯­è¨€æ€»ç»“                  â”‚
â”‚  ai.image(CT URL) â†’ å½±åƒåˆ†æ â†’ ç—…ç¶è¯†åˆ«ç»“æœ                  â”‚
â”‚  ai.image(æŒ‡æ ‡URL) â†’ è¡¨æ ¼è¯†åˆ« â†’ JSONB ç»“æ„åŒ–æ•°æ®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      3. PL/pgSQL å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œå¤šæ¨¡æ€å…³è”åˆ†æ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  smart_diagnosis_v3(patient_id) â€” ä¸»ç¼–æ’å‡½æ•°                 â”‚
â”‚    â†“                                                         â”‚
â”‚  prepare_diagnosis_context(patient_id) â€” å‡†å¤‡ä¸Šä¸‹æ–‡          â”‚
â”‚    â”œâ”€ è°ƒç”¨ get_multimodal_data() è·å–å…¨éƒ¨æ•°æ®                â”‚
â”‚    â””â”€ è¿”å›ç»Ÿä¸€ JSONB ç»“æ„                                    â”‚
â”‚    â†“                                                         â”‚
â”‚  compute_evidence_profile(context) â€” è¯æ®è®¡ç®—ä¸åŠ¨æ€åŠ æƒ        â”‚
â”‚    â”œâ”€ è°ƒç”¨è´¨é‡è¯„ä¼°å‡½æ•°ï¼ˆæ•°æ®åº“ç«¯ï¼‰                            â”‚
â”‚    â”‚   â”œâ”€ evaluate_text_quality() - æ–‡æœ¬è´¨é‡è¯„åˆ†             â”‚
â”‚    â”‚   â”‚   â€¢ æ‘˜è¦é•¿åº¦ (<50å­—ç¬¦: 0.6x, <100å­—ç¬¦: 0.8x)       â”‚
â”‚    â”‚   â”‚   â€¢ å…³é”®å‘ç°å®Œæ•´æ€§ (ç¼ºå¤±: 0.7x)                    â”‚
â”‚    â”‚   â”‚   â€¢ äººå·¥å¤æ ¸çŠ¶æ€ (å·²å¤æ ¸: 1.2x)                    â”‚
â”‚    â”‚   â”œâ”€ evaluate_ct_quality() - CTå½±åƒè´¨é‡è¯„åˆ†             â”‚
â”‚    â”‚   â”‚   â€¢ åˆ†æå®Œæ•´åº¦ (<100å­—ç¬¦: 0.7x)                    â”‚
â”‚    â”‚   â”‚   â€¢ éƒ¨ä½ä¿¡æ¯ (æœ‰éƒ¨ä½: 1.1x)                        â”‚
â”‚    â”‚   â”‚   â€¢ äººå·¥å¤æ ¸ (å·²å¤æ ¸: 1.3x)                        â”‚
â”‚    â”‚   â””â”€ evaluate_lab_quality() - å®éªŒå®¤è´¨é‡è¯„åˆ†            â”‚
â”‚    â”‚       â€¢ æŒ‡æ ‡æ•°é‡ (<5ä¸ª: 0.5x, <10ä¸ª: 0.8x)             â”‚
â”‚    â”‚       â€¢ å¼‚å¸¸æ•°é‡ (æœ‰å¼‚å¸¸: 1.2x)                        â”‚
â”‚    â”‚       â€¢ è§£è¯»è´¨é‡ (æœ‰è§£è¯»: 1.3x)                        â”‚
â”‚    â”œâ”€ åŠ¨æ€æƒé‡è®¡ç®—                                           â”‚
â”‚    â”‚   â€¢ åŸºç¡€æƒé‡: æ–‡æœ¬ 33%, CT 33%, å®éªŒå®¤ 34%             â”‚
â”‚    â”‚   â€¢ è°ƒæ•´æƒé‡ = åŸºç¡€æƒé‡ Ã— è´¨é‡åˆ†æ•°                      â”‚
â”‚    â”‚   â€¢ å½’ä¸€åŒ–: ä¿è¯æƒé‡æ€»å’Œ = 100%                        â”‚
â”‚    â”‚   â€¢ ç¤ºä¾‹: æ–‡æœ¬è´¨é‡0.5 â†’ è°ƒæ•´åæƒé‡19.9%                â”‚
â”‚    â”œâ”€ è°ƒç”¨ extract_key_evidence() æå–è¯æ®                   â”‚
â”‚    â”‚   â”œâ”€ ç—…å†å…³é”®å‘ç°ï¼ˆåŠ¨æ€æƒé‡ 19.9%ï¼‰                    â”‚
â”‚    â”‚   â”œâ”€ CT å½±åƒå‘ç°ï¼ˆåŠ¨æ€æƒé‡ 39.5%ï¼‰                     â”‚
â”‚    â”‚   â””â”€ å¼‚å¸¸æŒ‡æ ‡ï¼ˆåŠ¨æ€æƒé‡ 40.7%ï¼‰                        â”‚
â”‚    â”œâ”€ æ¯æ¡è¯æ®åŒ…å«ï¼šmodalityã€findingã€weightã€data_id      â”‚
â”‚    â””â”€ è¿”å› JSONBï¼ˆå«è´¨é‡åˆ†æ•°ã€æƒé‡ã€æº¯æºä¿¡æ¯ï¼‰               â”‚
â”‚    â†“                                                         â”‚
â”‚  detect_lab_anomalies(patient_id) â€” å¼‚å¸¸æ£€æµ‹                 â”‚
â”‚    â”œâ”€ æŸ¥è¯¢æ‚£è€…å†å²æŒ‡æ ‡æ•°æ®                                   â”‚
â”‚    â”œâ”€ è®¡ç®—å‡å€¼ã€æ ‡å‡†å·®ï¼ˆç»Ÿè®¡å­¦ï¼‰                             â”‚
â”‚    â”œâ”€ Z-score = (å½“å‰å€¼ - å‡å€¼) / æ ‡å‡†å·®                     â”‚
â”‚    â”œâ”€ åˆ¤æ–­ä¸¥é‡ç¨‹åº¦ï¼ˆ|Z-score| > 3: é‡åº¦ï¼Œ> 2: ä¸­åº¦ï¼Œ> 1: è½»åº¦ï¼‰â”‚
â”‚    â””â”€ è¿”å›å¼‚å¸¸æŒ‡æ ‡åˆ—è¡¨ï¼ˆå« Z-scoreã€severityï¼‰               â”‚
â”‚    â†“                                                         â”‚
â”‚  generate_ai_diagnosis(context, evidence) â€” AIè¯Šæ–­ç”Ÿæˆ       â”‚
â”‚    â”œâ”€ æ„å»º AI æç¤ºè¯ï¼ˆèåˆå¤šæ¨¡æ€æ•°æ®ï¼‰                        â”‚
â”‚    â”œâ”€ è°ƒç”¨ ai.generate_text() ç”Ÿæˆè¯Šæ–­ç»“è®º                   â”‚
â”‚    â”œâ”€ è§£æè¯Šæ–­æ–‡æœ¬ï¼Œæå–æ²»ç–—å»ºè®®å’Œé£é™©æé†’                    â”‚
â”‚    â””â”€ è¿”å›ç»“æ„åŒ–è¯Šæ–­ç»“æœ                                     â”‚
â”‚    â†“                                                         â”‚
â”‚  compute_risk_profile(context, evidence) â€” é£é™©è¯„åˆ†          â”‚
â”‚    â”œâ”€ åŸºäºå¼‚å¸¸æŒ‡æ ‡æ•°é‡å’Œä¸¥é‡ç¨‹åº¦                              â”‚
â”‚    â”œâ”€ è®¡ç®—é£é™©è¯„åˆ†ï¼ˆ0-1ï¼Œè¶Šé«˜é£é™©è¶Šå¤§ï¼‰                      â”‚
â”‚    â””â”€ è¿”å›é£é™©è¯„åˆ†å’Œåˆ†ç±»ï¼ˆä½/ä¸­/é«˜é£é™©ï¼‰                      â”‚
â”‚    â†“                                                         â”‚
â”‚  apply_confidence_calibration(raw_confidence) â€” ç½®ä¿¡åº¦æ ¡å‡†   â”‚
â”‚    â”œâ”€ ä» model_calibration è¡¨è¯»å–æœ€æ–°æ ¡å‡†å‚æ•°                â”‚
â”‚    â”œâ”€ åº”ç”¨ Temperature Scaling æ ¡å‡†ç®—æ³•                      â”‚
â”‚    â””â”€ è¿”å›æ ¡å‡†åçš„ç½®ä¿¡åº¦                                     â”‚
â”‚    â†“                                                         â”‚
â”‚  persist_diagnosis_result(...) â€” æŒä¹…åŒ–ç»“æœ                  â”‚
â”‚    â”œâ”€ å­˜å…¥ patient_diagnosis è¡¨                              â”‚
â”‚    â”‚   â”œâ”€ diagnosis_textï¼šè¯Šæ–­ç»“è®º                           â”‚
â”‚    â”‚   â”œâ”€ confidence_scoreï¼šåŸå§‹ç½®ä¿¡åº¦                       â”‚
â”‚    â”‚   â”œâ”€ calibrated_confidenceï¼šæ ¡å‡†åç½®ä¿¡åº¦                â”‚
â”‚    â”‚   â”œâ”€ risk_scoreï¼šé£é™©è¯„åˆ†                               â”‚
â”‚    â”‚   â”œâ”€ evidence_jsonï¼šå®Œæ•´è¯æ®é“¾ï¼ˆJSONBï¼‰                 â”‚
â”‚    â”‚   â”œâ”€ treatment_planï¼šæ²»ç–—å»ºè®®                           â”‚
â”‚    â”‚   â””â”€ medical_adviceï¼šé£é™©æé†’                           â”‚
â”‚    â””â”€ è¿”å›è¯Šæ–­è®°å½• ID å’Œå®Œæ•´æ•°æ®                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               4. è¿”å›ç»“æ„åŒ–è¯Šæ–­ç»“æœ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                          â”‚
â”‚    "diagnosis_id": 15,                                     â”‚
â”‚    "patient_id": 9,                                        â”‚
â”‚    "diagnosis": "æ€¥æ€§ç—…æ¯’æ€§è„‘ç‚",                           â”‚
â”‚    "confidence": 0.82,                                     â”‚
â”‚    "calibrated_confidence": 0.85,                          â”‚
â”‚    "risk_score": 0.65,                                     â”‚
â”‚    "evidence_summary": [                                   â”‚
â”‚      "ç—…å†ï¼ˆæƒé‡ 70.0%ï¼‰ï¼šçªå‘é«˜çƒ­ã€å‰§çƒˆå¤´ç—›ã€æ„è¯†éšœç¢",    â”‚
â”‚      "å½±åƒï¼ˆæƒé‡ 90.0%ï¼‰ï¼šé¢å¶å¼‚å¸¸ä¿¡å·",                    â”‚
â”‚      "æ£€éªŒï¼ˆæƒé‡ 80.0%ï¼‰ï¼šç™½ç»†èƒåé«˜ï¼šæ£€æµ‹å€¼ 10.24Ã—10^9/L"  â”‚
â”‚    ],                                                      â”‚
â”‚    "evidence_detail": { /* è¯¦ç»†è¯æ® */ },                 â”‚
â”‚    "recommendations": [                                    â”‚
â”‚      "ç«‹å³å®Œå–„å¤´é¢…MRIæ£€æŸ¥...",                             â”‚
â”‚      "ç»§ç»­é˜¿æ˜”æ´›éŸ¦é™è„‰è¾“æ³¨..."                             â”‚
â”‚    ],                                                      â”‚
â”‚    "warnings": ["æ³¨æ„ç›‘æµ‹...", "è­¦æƒ•ç™«ç—«å‘ä½œ..."]          â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒä¼˜åŠ¿

1. **åŸå­æ€§ä¿è¯**
   - æ•´ä¸ªè¯Šæ–­æµç¨‹åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­å®Œæˆ
   - è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
   - ä¿è¯æ•°æ®ä¸€è‡´æ€§

2. **æ€§èƒ½ä¼˜åŒ–**
   - åˆ©ç”¨æ•°æ®åº“ç´¢å¼•å’Œåˆ†ç‰‡é”®
   - é¿å…è·¨èŠ‚ç‚¹æŸ¥è¯¢
   - AI è°ƒç”¨åœ¨æ•°æ®åº“å†…å®Œæˆï¼Œæ— éœ€æ•°æ®åºåˆ—åŒ–

3. **è¯æ®å¯è¿½æº¯**
   - æ¯æ¡è¯æ®åŒ…å« `data_id`ï¼ˆåŸå§‹æ•°æ®IDï¼‰
   - å¯ä»¥è¿½æº¯åˆ°åŸå§‹ç—…å†ã€CTã€æŒ‡æ ‡æ•°æ®
   - å‰ç«¯å¯å®ç°"ç‚¹å‡»è¯æ®è·³è½¬åˆ°åŸå§‹æ•°æ®"

4. **æ™ºèƒ½è®¡ç®—**
   - ç½®ä¿¡åº¦åŸºäºè¯æ®å®Œæ•´æ€§ï¼ˆä¸æ˜¯éšæœºæ•°ï¼‰
   - é£é™©è¯„åˆ†åŸºäºç»Ÿè®¡å­¦ç®—æ³•ï¼ˆZ-scoreï¼‰
   - æ ¡å‡†åçš„ç½®ä¿¡åº¦æ›´å‡†ç¡®

5. **åŠ¨æ€åŠ æƒæœºåˆ¶** â­ æ–°å¢
   - **æ•°æ®è´¨é‡è‡ªé€‚åº”è¯„ä¼°**ï¼šæ ¹æ®æ•°æ®å®Œæ•´æ€§è‡ªåŠ¨è°ƒæ•´å„æ¨¡æ€æƒé‡
   - **å¤šç»´åº¦è´¨é‡è¯„åˆ†**ï¼š
     - æ–‡æœ¬ï¼šæ‘˜è¦é•¿åº¦ã€å…³é”®å‘ç°ã€äººå·¥å¤æ ¸
     - CTï¼šåˆ†æå®Œæ•´åº¦ã€éƒ¨ä½ä¿¡æ¯ã€äººå·¥å¤æ ¸
     - å®éªŒå®¤ï¼šæŒ‡æ ‡æ•°é‡ã€å¼‚å¸¸æ£€æµ‹ã€è§£è¯»è´¨é‡
   - **æƒé‡å½’ä¸€åŒ–**ï¼šç¡®ä¿è°ƒæ•´åæƒé‡æ€»å’Œä¸º 100%
   - **è´¨é‡åˆ†æ•°èŒƒå›´**ï¼š[0.3, 1.0]ï¼Œé¿å…æç«¯å€¼å½±å“è¯Šæ–­
   - **å¯è§†åŒ–å±•ç¤º**ï¼šå‰ç«¯æ˜¾ç¤ºè´¨é‡è¯„åˆ†è¿›åº¦æ¡ï¼ˆç»¿/æ©™/çº¢ï¼‰
   - **å®é™…æ¡ˆä¾‹**ï¼šæ–‡æœ¬è´¨é‡ 50% â†’ æƒé‡ä» 33% é™è‡³ 19.9%

### ä¸‰ã€è¯æ®æ‘˜è¦æ™ºèƒ½æ ¼å¼åŒ–

#### é—®é¢˜èƒŒæ™¯

æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹è¿”å›çš„æ£€éªŒæŒ‡æ ‡è¯æ®æ˜¯ JSON æ ¼å¼ï¼Œä¾‹å¦‚ï¼š

```
"æ£€éªŒï¼ˆæƒé‡ 34.0%ï¼‰ï¼š{\"ç™½ç»†èƒ\": {\"value\": \"10.24\", \"unit\": \"10^9/L\"}, \"çº¢ç»†èƒ\": {\"value\": \"3.78\", \"unit\": \"10^12/L\"}}"
```

è¿™ç§æ ¼å¼ä¸åˆ©äºå‰ç«¯å±•ç¤ºï¼Œç”¨æˆ·éš¾ä»¥ç†è§£ã€‚

#### è§£å†³æ–¹æ¡ˆ

åç«¯ API å±‚ï¼ˆ`backend/src/routes/database-analysis.js`ï¼‰è‡ªåŠ¨è§£æå¹¶æ ¼å¼åŒ–ä¸ºè‡ªç„¶è¯­è¨€ï¼š

**æ ¼å¼åŒ–é€»è¾‘**ï¼ˆ182-260 è¡Œï¼‰ï¼š

1. **è§£æ JSON å¯¹è±¡**
   - ä»å­—ç¬¦ä¸²ä¸­æå– JSON éƒ¨åˆ†
   - è§£ææ‰€æœ‰æ£€éªŒæŒ‡æ ‡çš„ nameã€valueã€unit

2. **è¯†åˆ«å¼‚å¸¸æŒ‡æ ‡**
   - æ£€æŸ¥æŒ‡æ ‡åç§°æ˜¯å¦å¸¦ `*` å‰ç¼€ï¼ˆæ•°æ®åº“æ ‡è®°ï¼‰
   - ç»“åˆ `detect_lab_anomalies()` ç»“æœç¡®è®¤å¼‚å¸¸

3. **ç”Ÿæˆæ–¹å‘æè¿°**
   - ä» Z-score åˆ¤æ–­åé«˜/åä½
   - `Z-score > 0` â†’ åé«˜
   - `Z-score < 0` â†’ åä½

4. **æ·»åŠ ä¸¥é‡ç¨‹åº¦**
   - ä» `severity` å­—æ®µè·å–ï¼ˆè½»åº¦/ä¸­åº¦/é‡åº¦ï¼‰
   - åªæœ‰ä¸­åº¦ã€é‡åº¦æ‰æ˜¾ç¤ºä¸¥é‡ç¨‹åº¦æ ‡æ³¨

5. **æ‹¼æ¥è‡ªç„¶è¯­è¨€**
   - æ ¼å¼ï¼š`æŒ‡æ ‡åç§° + æ–¹å‘ + æ£€æµ‹å€¼ + å•ä½ + ä¸¥é‡ç¨‹åº¦`
   - ç¤ºä¾‹ï¼š`ç™½ç»†èƒåé«˜ï¼šæ£€æµ‹å€¼ 10.24Ã—10^9/Lï¼Œä¸­åº¦`

**è½¬æ¢ç¤ºä¾‹**ï¼š

```javascript
// è¾“å…¥ï¼ˆæ•°æ®åº“è¿”å›ï¼‰
"æ£€éªŒï¼ˆæƒé‡ 34.0%ï¼‰ï¼š{\"ç™½ç»†èƒ\": {\"value\": \"10.24\", \"unit\": \"10^9/L\"}, \"çº¢ç»†èƒ\": {\"value\": \"3.78\", \"unit\": \"10^12/L\"}}"

// è¾“å‡ºï¼ˆåç«¯æ ¼å¼åŒ–åï¼‰
"æ£€éªŒï¼ˆæƒé‡ 34.0%ï¼‰ï¼šç™½ç»†èƒåé«˜ï¼šæ£€æµ‹å€¼ 10.24Ã—10^9/Lï¼›çº¢ç»†èƒåä½ï¼šæ£€æµ‹å€¼ 3.78Ã—10^12/Lï¼Œä¸­åº¦"
```

#### å‰ç«¯å±•ç¤ºæ•ˆæœ

**æ™ºèƒ½è¯Šæ–­é¢æ¿ç»„ä»¶**ï¼ˆ`SmartDiagnosisPanel.vue`ï¼‰ï¼š

- ğŸ“‹ **è¯Šæ–­ç»“è®ºå¡ç‰‡**ï¼ˆç´«è‰²æ¸å˜èƒŒæ™¯ï¼‰
- ğŸ“Š **ç½®ä¿¡åº¦ã€æ ¡å‡†å€¼ã€é£é™©è¯„åˆ†æ ‡ç­¾**
- ğŸ” **å…³é”®è¯æ®æ‘˜è¦**ï¼ˆè‡ªç„¶è¯­è¨€ï¼Œæ—  JSONï¼‰
  - ç—…å†ï¼ˆæƒé‡ 70.0%ï¼‰ï¼šçªå‘é«˜çƒ­ã€å‰§çƒˆå¤´ç—›ã€æ„è¯†éšœç¢
  - å½±åƒï¼ˆæƒé‡ 90.0%ï¼‰ï¼šé¢å¶å¼‚å¸¸ä¿¡å·
  - æ£€éªŒï¼ˆæƒé‡ 80.0%ï¼‰ï¼šç™½ç»†èƒåé«˜ï¼šæ£€æµ‹å€¼ 10.24Ã—10^9/L
- ğŸ“„ **è¯¦ç»†è¯æ®**
  - ç—…å†ï¼šå®Œæ•´ç—…å†æ‘˜è¦
  - å½±åƒï¼šCT åˆ†æç»“æœ
  - æ£€éªŒï¼šåªæ˜¾ç¤ºå¼‚å¸¸æŒ‡æ ‡è¡¨æ ¼ï¼ˆæ­£å¸¸æŒ‡æ ‡å·²è¿‡æ»¤ï¼‰
- ğŸ’Š **æ²»ç–—å»ºè®®åˆ—è¡¨**
- âš ï¸ **é£é™©æé†’**
- ğŸ“ˆ **é£é™©è¯„åˆ†ä»ªè¡¨ç›˜**ï¼ˆECharts å¯è§†åŒ–ï¼‰

### å››ã€å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹å¼ | ä¼˜åŠ¿ |
|--------|---------|------|
| **å¤šæ¨¡æ€å…³è”** | å­æŸ¥è¯¢ + `row_to_json()` | ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰æ•°æ® |
| **åŠ¨æ€åŠ æƒ** â­ | è´¨é‡è¯„ä¼°å‡½æ•° + è‡ªé€‚åº”è®¡ç®— | æ ¹æ®æ•°æ®è´¨é‡è°ƒæ•´æƒé‡ï¼Œæå‡è¯Šæ–­å‡†ç¡®æ€§ |
| **å¼‚å¸¸æ£€æµ‹** | Z-score ç»Ÿè®¡å­¦ç®—æ³• | è‡ªåŠ¨è¯†åˆ«æ˜¾è‘—å¼‚å¸¸ï¼Œæ— éœ€äººå·¥é˜ˆå€¼ |
| **AI è°ƒç”¨** | `ai.generate_text()` æ•°æ®åº“å†…è°ƒç”¨ | å‡å°‘ç½‘ç»œä¼ è¾“ï¼Œæå‡æ€§èƒ½ |
| **è¯æ®æº¯æº** | JSONB `evidence_json` å« `data_id` | å¯å›æº¯åˆ°åŸå§‹æ•°æ® |
| **è‡ªç„¶è¯­è¨€** | åç«¯è§£æ JSON â†’ æ ¼å¼åŒ–æ–‡æœ¬ | æå‡ç”¨æˆ·ä½“éªŒï¼Œæ˜“äºç†è§£ |
| **é£é™©è¯„åˆ†** | åŸºäºå¼‚å¸¸æ•°é‡å’Œ Z-score | é‡åŒ–æ‚£è€…é£é™©ï¼Œè¾…åŠ©å†³ç­– |
| **ç½®ä¿¡åº¦æ ¡å‡†** | Temperature Scaling ç®—æ³• | æé«˜ç½®ä¿¡åº¦å‡†ç¡®æ€§ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿåˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å±‚ (Vue 3 + Element Plus)               â”‚
â”‚  æ‚£è€…ç®¡ç† | æ•°æ®ä¸Šä¼  | æ™ºèƒ½åˆ†æ | PDF å¯¼å‡º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTP REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯å±‚ (Node.js + Express)                  â”‚
â”‚  API è·¯ç”± | ä¸šåŠ¡æœåŠ¡ | ä¸ƒç‰›äº‘é›†æˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“å±‚ (OpenTenBase + AI æ’ä»¶)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ PL/pgSQL æ™ºèƒ½åˆ†æå¼•æ“ (709 è¡Œ)    â”‚     â”‚
â”‚  â”‚ - å¤šæ¨¡æ€å…³è”æŸ¥è¯¢                   â”‚     â”‚
â”‚  â”‚ - æ•°æ®è´¨é‡è¯„ä¼°ï¼ˆåŠ¨æ€åŠ æƒï¼‰ â­      â”‚     â”‚
â”‚  â”‚ - è¯æ®æå–ä¸æƒé‡è®¡ç®—               â”‚     â”‚
â”‚  â”‚ - å¼‚å¸¸æ£€æµ‹ (Z-score)              â”‚     â”‚
â”‚  â”‚ - AI è¯Šæ–­ç”Ÿæˆ                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ AI æ’ä»¶ (opentenbase_ai)          â”‚     â”‚
â”‚  â”‚ - ai.image() - OCR/å›¾åƒåˆ†æ        â”‚     â”‚
â”‚  â”‚ - ai.generate_text() - æ–‡æœ¬ç”Ÿæˆ    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ åˆ†ç‰‡è¡¨ (DISTRIBUTE BY SHARD)      â”‚     â”‚
â”‚  â”‚ - patients (æ‚£è€…ä¿¡æ¯)              â”‚     â”‚
â”‚  â”‚ - patient_text_data (ç—…å†)         â”‚     â”‚
â”‚  â”‚ - patient_ct_data (CT å½±åƒ)        â”‚     â”‚
â”‚  â”‚ - patient_lab_data (å®éªŒå®¤æŒ‡æ ‡)    â”‚     â”‚
â”‚  â”‚ - patient_diagnosis (è¯Šæ–­è®°å½•)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‘å­˜å‚¨å±‚ (ä¸ƒç‰›äº‘ CDN)                       â”‚
â”‚  ç—…å†å›¾ç‰‡ | CT å½±åƒ | å®éªŒå®¤æŒ‡æ ‡è¡¨æ ¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯å±‚ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬/è¯´æ˜ |
|-------|---------|----------|
| **å‰ç«¯** | Vue 3 + Pinia + Element Plus + TailwindCSS | Composition API |
| **åç«¯** | Node.js + Express.js + Winston | >= 18.0.0 |
| **æ•°æ®åº“** | OpenTenBase (åˆ†å¸ƒå¼ PostgreSQL) | AI æ’ä»¶æ”¯æŒ |
| **AI** | opentenbase_ai æ’ä»¶ | æ•°æ®åº“å†… AI è°ƒç”¨ |
| **å­˜å‚¨** | ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ | CDN åŠ é€Ÿ |
| **ç®—æ³•** | Z-score å¼‚å¸¸æ£€æµ‹ + LATERAL JOIN | ç»Ÿè®¡å­¦ + SQL |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js >= 18.0.0
- OpenTenBase æ•°æ®åº“ï¼ˆå·²å®‰è£… `opentenbase_ai` æ’ä»¶ï¼‰
- ä¸ƒç‰›äº‘è´¦å·ï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/jhzhou002/smart_medical.git
cd smart_medical

# 2. å¯åŠ¨åç«¯
cd backend
npm install
cp .env.example .env  # é…ç½®æ•°æ®åº“å’Œä¸ƒç‰›äº‘
npm run dev           # http://127.0.0.1:3000

# 3. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm install
npm run dev           # http://127.0.0.1:5173
```

### æµ‹è¯•æ¥å£

```bash
# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:3000/health

# æ™ºèƒ½è¯Šæ–­
curl -X POST http://127.0.0.1:3000/api/db-analysis/smart-diagnosis \
  -H "Content-Type: application/json" \
  -d '{"patient_id": 9}'
```

---

## ğŸ“Š æ•°æ®åº“ç«¯ PL/pgSQL åˆ†æåŠŸèƒ½

### æ ¸å¿ƒå­˜å‚¨å‡½æ•°

| å‡½æ•°å | åŠŸèƒ½ | ä»£ç è¡Œæ•° |
|-------|------|---------|
| `smart_diagnosis_v3()` | æ™ºèƒ½è¯Šæ–­ä¸»æµç¨‹ï¼ˆç¼–æ’ï¼‰ | 33 è¡Œ |
| `prepare_diagnosis_context()` | å‡†å¤‡è¯Šæ–­ä¸Šä¸‹æ–‡æ•°æ® | 108 è¡Œ |
| `compute_evidence_profile()` | è®¡ç®—è¯æ®æƒé‡ï¼ˆå«åŠ¨æ€åŠ æƒï¼‰ | 80 è¡Œ |
| `evaluate_text_quality()` | ç—…å†æ–‡æœ¬è´¨é‡è¯„ä¼° | 32 è¡Œ |
| `evaluate_ct_quality()` | CT å½±åƒè´¨é‡è¯„ä¼° | 35 è¡Œ |
| `evaluate_lab_quality()` | å®éªŒå®¤æŒ‡æ ‡è´¨é‡è¯„ä¼° | 30 è¡Œ |
| `compute_risk_profile()` | è®¡ç®—é£é™©è¯„åˆ† | 37 è¡Œ |
| `generate_ai_diagnosis()` | AI è¯Šæ–­ç”Ÿæˆ | 95 è¡Œ |
| `apply_confidence_calibration()` | ç½®ä¿¡åº¦æ ¡å‡† | 31 è¡Œ |
| `persist_diagnosis_result()` | æŒä¹…åŒ–è¯Šæ–­ç»“æœ | 96 è¡Œ |
| `get_multimodal_data()` | å¤šæ¨¡æ€æ•°æ®ç»Ÿä¸€æŸ¥è¯¢ | 27 è¡Œ |
| `extract_key_evidence()` | å…³é”®è¯æ®æå– | 50 è¡Œ |
| `detect_lab_anomalies()` | Z-score å¼‚å¸¸æ£€æµ‹ | 55 è¡Œ |

**æ€»è®¡ï¼š709 è¡Œ PL/pgSQL ä»£ç **ï¼ˆå«åŠ¨æ€åŠ æƒåŠŸèƒ½ï¼‰

### API æ¥å£

```bash
# å¤šæ¨¡æ€æ•°æ®æŸ¥è¯¢
GET /api/db-analysis/multimodal/:patient_id

# å…³é”®è¯æ®æå–
GET /api/db-analysis/evidence/:patient_id

# å¼‚å¸¸æ£€æµ‹
GET /api/db-analysis/anomalies/:patient_id

# æ™ºèƒ½è¯Šæ–­ï¼ˆæ ¸å¿ƒï¼‰
POST /api/db-analysis/smart-diagnosis
Body: { "patient_id": 9 }

# ç»¼åˆåˆ†æ
GET /api/db-analysis/comprehensive/:patient_id
```

---

## ğŸ¯ æ¯”èµ›è¦æ±‚æ»¡è¶³æƒ…å†µ

### æ ¸å¿ƒæŒ‡æ ‡å¯¹ç…§

| æ¯”èµ›è¦æ±‚ | å®ç°æƒ…å†µ | æŠ€æœ¯æ–¹æ¡ˆ |
|---------|---------|---------|
| **â‰¥3 æ¨¡æ€æ•´åˆ** | âœ… 4ä¸ªæ¨¡æ€ | ç—…å† + CT + å®éªŒå®¤ + æ‚£è€…ä¿¡æ¯ |
| **ç»Ÿä¸€ SQL å…³è”åˆ†æ** | âœ… å­æŸ¥è¯¢å…³è” | `get_multimodal_data()` ä¸€æ¡ SQL å®Œæˆ |
| **PL/pgSQL å¤æ‚æµç¨‹** | âœ… 612 è¡Œ | 10 ä¸ªå­˜å‚¨å‡½æ•° + 3 ä¸ªè§¦å‘å™¨ + 1 ä¸ªè§†å›¾ |
| **æ•°æ®åº“ç«¯ AI è°ƒç”¨** | âœ… å®Œæˆ | `ai.image()` + `ai.generate_text()` |
| **è¯æ®å¯è¿½æº¯æ€§** | âœ… JSONB å­˜å‚¨ | `evidence_json` å« `data_id`ã€æƒé‡ã€æ¥æº |
| **ç»“æ„åŒ–åˆ†æç»“æœ** | âœ… å®Œæˆ | è¯Šæ–­ã€ç½®ä¿¡åº¦ã€é£é™©è¯„åˆ†ã€æ²»ç–—å»ºè®® |

### æŠ€æœ¯äº®ç‚¹å¯¹æ¯”

| å¯¹æ¯”ç»´åº¦ | åº”ç”¨å±‚åˆ†æ | æ•°æ®åº“ç«¯åˆ†æï¼ˆâ­ æœ¬ç³»ç»Ÿï¼‰ |
|---------|-----------|---------------------|
| **æ•°æ®ä¼ è¾“** | 4+ æ¬¡æŸ¥è¯¢ | 1 æ¬¡æŸ¥è¯¢ï¼ˆå‡å°‘ 75%ï¼‰ |
| **å“åº”æ—¶é—´** | 200-500ms | 80-150msï¼ˆæå‡ 40%ï¼‰ |
| **è¯æ®æº¯æº** | âŒ æ— æ³•è¿½æº¯ | âœ… JSONB å®Œæ•´è®°å½• |
| **å¼‚å¸¸æ£€æµ‹** | ç®€å•é˜ˆå€¼åˆ¤æ–­ | âœ… Z-score ç»Ÿè®¡å­¦ç®—æ³• |
| **ä»£ç ç»´æŠ¤** | åˆ†æ•£å¤šä¸ªæ–‡ä»¶ | âœ… é›†ä¸­åœ¨å­˜å‚¨è¿‡ç¨‹ |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿå¼€å‘ | âœ… ç”Ÿäº§ç¯å¢ƒã€é«˜æ€§èƒ½è¦æ±‚ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
smart_medical/
â”œâ”€â”€ frontend/                    # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/         # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ SmartDiagnosisPanel.vue  # æ™ºèƒ½è¯Šæ–­é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ EvidenceViewer.vue       # è¯æ®æŸ¥çœ‹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ RiskScoreGauge.vue       # é£é™©è¯„åˆ†ä»ªè¡¨ç›˜
â”‚   â”‚   â””â”€â”€ api/                # API å°è£…
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                    # Node.js åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/            # æ•°æ®åº“ã€æ—¥å¿—é…ç½®
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ database-analysis.js  # æ•°æ®åº“ç«¯åˆ†æ API
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ opentenbase-ai.js     # AI æ’ä»¶å°è£…
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ smart_diagnosis_v3.sql    # PL/pgSQL è„šæœ¬
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ doc/                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ CLAUDE.md                  # Claude Code æŒ‡å—
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **é¡¹ç›®æ–¹æ¡ˆ**ï¼š[doc/åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°æ•´ä½“æ–¹æ¡ˆæ–‡æ¡£.md](doc/åŒ»ç–—æ™ºèƒ½åˆ†æå¹³å°æ•´ä½“æ–¹æ¡ˆæ–‡æ¡£ï¼ˆåŸºäºOpenTenBase%20AIæ’ä»¶ï¼‰.md)
- **AI æ’ä»¶**ï¼š[doc/23-opentenbase_ai.md](doc/23-opentenbase_ai.md)
- **å¼€å‘æŒ‡å—**ï¼š[CLAUDE.md](CLAUDE.md)

---

## ğŸ‘¥ å›¢é˜Ÿä¿¡æ¯

**å¼€å‘è€…**: å‘¨ä½³è±ª
**é‚®ç®±**: jhzhou0704@163.com
**GitHub**: [@jhzhou002](https://github.com/jhzhou002)

### è‡´è°¢

æ„Ÿè°¢ [OpenTenBase](https://github.com/OpenTenBase/OpenTenBase)ã€[å¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼š](https://www.openatom.org/)ã€[Vue.js](https://vuejs.org/)ã€[Element Plus](https://element-plus.org/)ã€[ä¸ƒç‰›äº‘](https://www.qiniu.com/) çš„æ”¯æŒã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼**
